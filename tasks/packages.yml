---
- stat: path='/opt/rb/rabbitmq-server_3.6.4-1_all.deb'
  register: debFile
  
# Install required packages
- name: download rabbit
  get_url: url=https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.4/rabbitmq-server_3.6.4-1_all.deb dest=/opt/ mode=0440  
  when: debFile.stat.exists == False

- name: install required packages
  apt: deb=/opt/rabbitmq-server_3.6.4-1_all.deb
  when: debFile.stat.exists == False

- name: install ssl-cert
  apt: pkg=ssl-cert state=present
  when: rabbitmq_ssl and rabbitmq_ssl_use_snakeoil_cert

- name: add rabbitmq user to the ssl-cert group
  user: name=rabbitmq append=yes groups=ssl-cert
  when: rabbitmq_ssl and rabbitmq_ssl_use_snakeoil_cert
